$skin-islands-v3-arrow-border-width ?= 0.2*rem
$skin-islands-v3-arrow-height ?= 3.2*rem
$skin-islands-v3-arrow-color  ?= #FC0

skin-islands-v3-arrow($this)
  $height = $this.units[0] or $skin-islands-v3-arrow-height
  $tail-width = round(($height / 2) * tan(30deg), 3) + 0.5*$skin-islands-v3-arrow-border-width

  if $this.params.tail
    skin-islands-v3-arrow-tail($this)
  else
    if $this.params.search
      padding: ($islands_xs - 0.1*rem) ($islands_m - 0.2*rem) ($islands_xs - 0.1*rem) ($islands_xs - 0.1*rem)
    else
      padding: ($islands_xs + 0.2*rem) ($islands_m - 0.2*rem)
      line-height: $height - (2*$islands_xs + 0.4*rem)

      if ($this.params.negative-margin)
        margin-right: -($tail-width)

    white-space: nowrap
    overflow: hidden

    unless ($this.params.no-elements)
      padding-right: ($islands_m - 0.2*rem) + 0.5*$tail-width

      stylobate_defaults($this,
        -tail '&:after')

      stylobate_defaults($this,
        -body '&:before')

    deprecate($this.params, no-elements)

skin-islands-v3-arrow-body($this)
  pseudo-with-content()

  +cache()
    z-index: -1
    position: absolute
    top: 0
    right: 0
    bottom: 0
    left: 0

  $height = $this.units[0] or $this['parent']['units'][0] or $skin-islands-v3-arrow-height
  $color = $this.colors[0] or $this['parent']['colors'][0] or $skin-islands-v3-arrow-color
  +cache($height $color)
    $tail-width = round(($height / 2) * tan(30deg), 3)
    margin-right: $tail-width

    border: $skin-islands-v3-arrow-border-width solid transparent
    border-right: 0

    background: \
      linear-gradient(90deg, $islands-v3_bg_main, $islands-v3_bg_main) padding-box, \
      linear-gradient(90deg, $color, $color) border-box

skin-islands-v3-arrow-tail($this)
  pseudo-with-content()

  +cache()
    z-index: -1
    position: absolute
    left: 100%
    top: 50%

    transform: translate(-50%,-50%) scale(0.5,1) rotate(-135deg)

  $height = ($this.units[0] or $this['parent']['units'][0] or $skin-islands-v3-arrow-height) - 2*$skin-islands-v3-arrow-border-width
  $color = $this.colors[0] or $this['parent']['colors'][0] or $skin-islands-v3-arrow-color
  +cache($height $color)
    $sqrt2 = 1.414213562
    $tail-width = round(($height / 2) * tan(30deg), 3) + $skin-islands-v3-arrow-border-width
    width: round($height * (1/$sqrt2), 1)
    height: round($height * (1/$sqrt2), 1)
    margin-left: -($tail-width)

    border: ($skin-islands-v3-arrow-border-width + 0.1*rem) solid transparent

    background: \
      linear-gradient(45deg, $islands-v3_bg_main 50%, transparent 50%) no-repeat padding-box, \
      linear-gradient(45deg, $color 50%, transparent 50%) border-box

    // Fix jugged edges in Chrome
    if alpha($color) == 1
      -webkit-backface-visibility: hidden;
